<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‹±è¯­å°ç‹— Â· å®¶åº­ç»ˆæç‰ˆ</title>

<style>
body{
  margin:0;
  font-family:"Comic Sans MS","PingFang SC",sans-serif;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh;
  text-align:center;
  padding:20px 0;
}
h1{margin:8px;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}
.hidden{display:none!important}

/* ===== å¡ç‰‡ ===== */
.card{
  background:#fff;border-radius:18px;
  padding:20px;max-width:440px;
  margin:10px auto;
  box-shadow:0 8px 24px rgba(0,0,0,.2);
}
button{
  width:100%;padding:14px;
  margin:6px 0;font-size:16px;
  border:none;border-radius:12px;
  background:#4caf50;color:#fff;
  cursor:pointer;
  transition:all 0.3s;
  font-weight:bold;
}
button:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
button:active{transform:translateY(0)}
.secondary{background:#2196f3}
.shop{background:#ff9800}
.back{background:#9e9e9e}
.design{background:#e91e63}
input[type=range]{width:90%;margin:8px 0}
input[type=color]{margin:6px;width:60px;height:40px;border:none;border-radius:8px;cursor:pointer}
input[type=text]{
  width:90%;padding:12px;margin:8px 0;
  border:2px solid #ddd;border-radius:8px;
  font-size:16px;
}

/* ===== å°ç‹—å®¹å™¨ ===== */
.pet-wrap{
  position:relative;
  margin:20px auto;
  width:320px;
  height:380px;
  display:flex;
  justify-content:center;
  align-items:center;
}
.pet{
  width:280px;height:360px;
  transition:transform .3s;
  filter:drop-shadow(0 4px 8px rgba(0,0,0,0.15));
}
.pet.happy{transform:translateY(-12px) scale(1.05)}

/* ===== æŒ–ç©ºåŠ¨ç”» ===== */
.blank{
  display:inline-block;
  width:24px;
  border-bottom:3px solid #333;
  margin:0 2px;
  animation:pulse .8s infinite alternate;
}
@keyframes pulse{
  from{opacity:.4}
  to{opacity:1}
}
.letter-btn{
  width:auto;
  display:inline-block;
  margin:4px;
  padding:12px 18px;
  font-size:18px;
  font-weight:bold;
}

/* ===== è®¾è®¡é¢æ¿ ===== */
.design-controls{
  text-align:left;
  margin:10px 0;
}
.design-controls label{
  display:block;
  margin:12px 0 4px 0;
  font-weight:bold;
  color:#333;
}
.range-value{
  display:inline-block;
  margin-left:10px;
  color:#666;
  font-weight:bold;
}

/* ===== è®¾è®¡åº“ ===== */
.design-gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
  gap:10px;
  margin:15px 0;
}
.design-item{
  background:#f5f5f5;
  border-radius:12px;
  padding:10px;
  cursor:pointer;
  transition:all 0.3s;
  border:3px solid transparent;
}
.design-item:hover{
  border-color:#e91e63;
  transform:scale(1.05);
}
.design-item svg{
  width:100%;
  height:auto;
}
.design-name{
  font-size:12px;
  margin-top:5px;
  color:#666;
}
.delete-btn{
  background:#f44336;
  padding:4px 8px;
  font-size:12px;
  margin-top:4px;
}

/* ===== çŠ¶æ€æ˜¾ç¤º ===== */
#status, #score{
  background:rgba(255,255,255,0.9);
  display:inline-block;
  padding:10px 20px;
  border-radius:20px;
  margin:5px;
  font-weight:bold;
  color:#333;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
</style>
</head>

<body>

<h1>ğŸ¶ æˆ‘çš„è‹±è¯­å°ç‹—</h1>

<!-- ===== å°ç‹— ===== -->
<div class="pet-wrap">
<svg id="dog" class="pet" viewBox="0 0 200 360">
  <!-- èº«ä½“ -->
  <ellipse cx="100" cy="200" rx="65" ry="90" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="3"/>
  
  <!-- å¤´ -->
  <circle cx="100" cy="100" r="55" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="3"/>
  
  <!-- å·¦è€³ -->
  <g id="earL" transform-origin="55 65">
    <ellipse cx="55" cy="65" rx="18" ry="38" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="2"/>
    <ellipse cx="55" cy="70" rx="10" ry="20" fill="#ffb6c1"/>
  </g>
  
  <!-- å³è€³ -->
  <g id="earR" transform-origin="145 65">
    <ellipse cx="145" cy="65" rx="18" ry="38" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="2"/>
    <ellipse cx="145" cy="70" rx="10" ry="20" fill="#ffb6c1"/>
  </g>
  
  <!-- å·¦çœ¼ -->
  <g id="eyeL" transform-origin="85 95">
    <ellipse cx="85" cy="95" rx="8" ry="10" fill="#fff" stroke="#333" stroke-width="1"/>
    <circle cx="85" cy="97" r="5" fill="#000"/>
    <circle cx="86" cy="95" r="2" fill="#fff"/>
  </g>
  
  <!-- å³çœ¼ -->
  <g id="eyeR" transform-origin="115 95">
    <ellipse cx="115" cy="95" rx="8" ry="10" fill="#fff" stroke="#333" stroke-width="1"/>
    <circle cx="115" cy="97" r="5" fill="#000"/>
    <circle cx="116" cy="95" r="2" fill="#fff"/>
  </g>
  
  <!-- é¼»å­ -->
  <ellipse cx="100" cy="115" rx="8" ry="6" fill="#000"/>
  
  <!-- å˜´å·´ -->
  <path d="M88 125 Q100 135 112 125" stroke="#000" stroke-width="3" fill="none"/>
  
  <!-- å‰è…¿ -->
  <rect x="70" y="270" width="12" height="70" rx="6" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="2"/>
  <rect x="118" y="270" width="12" height="70" rx="6" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="2"/>
  
  <!-- åè…¿ -->
  <rect x="55" y="270" width="12" height="70" rx="6" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="2"/>
  <rect x="133" y="270" width="12" height="70" rx="6" fill="var(--dogColor,#fff)" stroke="#888" stroke-width="2"/>
  
  <!-- å°¾å·´ -->
  <path d="M155 210 Q175 200 180 180" stroke="var(--dogColor,#fff)" stroke-width="15" fill="none" stroke-linecap="round"/>
  
  <!-- é…é¥°é”šç‚¹ (é¡¹åœˆ) -->
  <g id="accessory">
    <rect x="75" y="145" width="50" height="8" rx="4" fill="#ff1744"/>
    <circle cx="100" cy="149" r="5" fill="#ffd700" stroke="#ff1744" stroke-width="2"/>
  </g>
</svg>
</div>

<div id="status"></div>
<div id="score"></div>

<!-- ===== ä¸»é¡µ ===== -->
<div class="card" id="home">
  <button onclick="enterStudy()">ğŸ“˜ å­¦ä¹ æ¨¡å¼</button>
  <button class="secondary" onclick="enterCheckup()">ğŸ¥ ä½“æ£€ï¼ˆ10é¢˜ï¼‰</button>
  <button class="shop" onclick="openShop()">ğŸ’Š è¯å“å•†åº—</button>
  <button class="design" onclick="openDesign()">ğŸ¨ è®¾è®¡å°ç‹—</button>
</div>

<!-- ===== å­¦ä¹  / ä½“æ£€å…±ç”¨ç­”é¢˜åŒº ===== -->
<div class="card hidden" id="quiz">
  <div id="quizTitle" style="font-size:20px;font-weight:bold;margin-bottom:15px"></div>
  <div id="question" style="font-size:18px;margin:15px 0;color:#333"></div>

  <div id="choices">
    <button onclick="choose(0)" id="c0"></button>
    <button onclick="choose(1)" id="c1"></button>
  </div>

  <div id="spell" class="hidden">
    <div id="spellHint" style="margin:10px 0;font-size:16px;color:#666"></div>
    <input type="text" id="spellInput" placeholder="è¯·è¾“å…¥è‹±æ–‡æ‹¼å†™">
    <button onclick="spellCheck()">âœ… æäº¤ç­”æ¡ˆ</button>
  </div>

  <div id="blank" class="hidden">
    <div id="blankWord" style="font-size:24px;margin:15px 0;letter-spacing:2px"></div>
    <div id="letters"></div>
  </div>

  <button class="back" onclick="backHome()">â¬… è¿”å›ä¸»é¡µ</button>
</div>

<!-- ===== å•†åº— ===== -->
<div class="card hidden" id="shop">
  <h3 style="color:#ff9800">ğŸ’Š è¯å“å•†åº—ï¼ˆ5 ç§¯åˆ† / ä¸ªï¼‰</h3>
  <p style="color:#666;font-size:14px">è¯·æ ¹æ®ç—‡çŠ¶è´­ä¹°å¯¹åº”çš„è¯å“</p>
  <button onclick="buyMedicine('headache')">ğŸ’Š å¤´ç—›è¯ (Headache)</button>
  <button onclick="buyMedicine('toothache')">ğŸ’Š ç‰™ç—›è¯ (Toothache)</button>
  <button onclick="buyMedicine('stomach-ache')">ğŸ’Š èƒƒç—›è¯ (Stomach-ache)</button>
  <button onclick="buyMedicine('backache')">ğŸ’Š èƒŒç—›è¯ (Backache)</button>
  <button onclick="buyMedicine('cold')">ğŸ’Š æ„Ÿå†’è¯ (Cold)</button>
  <button onclick="buyMedicine('hurt')">ğŸ’Š å¤–ä¼¤è¯ (Hurt)</button>
  <button class="back" onclick="closeShop()">â¬… è¿”å›</button>
</div>

<!-- ===== è®¾è®¡é¢æ¿ ===== -->
<div class="card hidden" id="designPanel">
  <h3 style="color:#e91e63">ğŸ¨ è®¾è®¡ä½ çš„å°ç‹—ï¼ˆ2 ç§¯åˆ†ï¼‰</h3>
  
  <div class="design-controls">
    <label>ğŸ¨ å°ç‹—é¢œè‰²:</label>
    <input type="color" id="colorPicker" value="#ffffff">
    
    <label>ğŸ‘‚ å·¦è€³è§’åº¦: <span class="range-value" id="earLVal">0Â°</span></label>
    <input type="range" id="earLAngle" min="-45" max="45" value="0" step="1">
    
    <label>ğŸ‘‚ å³è€³è§’åº¦: <span class="range-value" id="earRVal">0Â°</span></label>
    <input type="range" id="earRAngle" min="-45" max="45" value="0" step="1">
    
    <label>ğŸ‘ï¸ å·¦çœ¼è§’åº¦: <span class="range-value" id="eyeLVal">0Â°</span></label>
    <input type="range" id="eyeLAngle" min="-20" max="20" value="0" step="1">
    
    <label>ğŸ‘ï¸ å³çœ¼è§’åº¦: <span class="range-value" id="eyeRVal">0Â°</span></label>
    <input type="range" id="eyeRAngle" min="-20" max="20" value="0" step="1">
    
    <label>ğŸ’¾ è®¾è®¡åç§°:</label>
    <input type="text" id="designName" placeholder="ç»™ä½ çš„è®¾è®¡èµ·ä¸ªåå­—">
  </div>
  
  <button onclick="saveDesign()">ğŸ’¾ ä¿å­˜åˆ°è®¾è®¡åº“ï¼ˆ-2ç§¯åˆ†ï¼‰</button>
  <button class="secondary" onclick="viewGallery()">ğŸ–¼ï¸ æŸ¥çœ‹è®¾è®¡åº“</button>
  <button class="back" onclick="closeDesign()">â¬… è¿”å›</button>
</div>

<!-- ===== è®¾è®¡åº“ ===== -->
<div class="card hidden" id="gallery">
  <h3 style="color:#e91e63">ğŸ–¼ï¸ æˆ‘çš„è®¾è®¡åº“</h3>
  <div id="galleryGrid" class="design-gallery"></div>
  <button class="back" onclick="closeGallery()">â¬… è¿”å›è®¾è®¡</button>
</div>

<script>
/* ===== è¯åº“ï¼ˆæŒ‰ç–¾ç—…åˆ†ç±»ï¼‰ ===== */
const WORD_GROUPS = {
  headache: [
    ["practice","ç»ƒä¹ "],["prepare","å‡†å¤‡"],["brain","å¤§è„‘"],
    ["think","æ€è€ƒ"],["remember","è®°ä½"],["forget","å¿˜è®°"],
    ["study","å­¦ä¹ "],["focus","ä¸“æ³¨"],["concentrate","é›†ä¸­"],
    ["tired","ç–²åŠ³çš„"]
  ],
  toothache: [
    ["eat","åƒ"],["sweet","ç”œçš„"],["candy","ç³–æœ"],
    ["brush","åˆ·"],["tooth","ç‰™é½¿"],["mouth","å˜´"],
    ["dentist","ç‰™åŒ»"],["clean","æ¸…æ´"],["healthy","å¥åº·çš„"],
    ["pain","ç–¼ç—›"]
  ],
  "stomach-ache": [
    ["stomach","èƒƒ"],["food","é£Ÿç‰©"],["digest","æ¶ˆåŒ–"],
    ["hungry","é¥¥é¥¿çš„"],["full","é¥±çš„"],["sick","æ¶å¿ƒçš„"],
    ["medicine","è¯"],["rest","ä¼‘æ¯"],["water","æ°´"],
    ["careful","å°å¿ƒçš„"]
  ],
  backache: [
    ["back","èƒŒéƒ¨"],["sit","å"],["stand","ç«™"],
    ["posture","å§¿åŠ¿"],["exercise","é”»ç‚¼"],["stretch","ä¼¸å±•"],
    ["strong","å¼ºå£®çš„"],["weak","è™šå¼±çš„"],["support","æ”¯æ’‘"],
    ["comfortable","èˆ’é€‚çš„"]
  ],
  cold: [
    ["cold","æ„Ÿå†’"],["fever","å‘çƒ§"],["cough","å’³å—½"],
    ["sneeze","æ‰“å–·åš"],["tissue","çº¸å·¾"],["warm","æ¸©æš–çš„"],
    ["rest","ä¼‘æ¯"],["sleep","ç¡è§‰"],["temperature","ä½“æ¸©"],
    ["recover","æ¢å¤"]
  ],
  hurt: [
    ["hurt","å—ä¼¤"],["wound","ä¼¤å£"],["bandage","ç»·å¸¦"],
    ["cut","åˆ‡ä¼¤"],["fall","è·Œå€’"],["careful","å°å¿ƒçš„"],
    ["dangerous","å±é™©çš„"],["safe","å®‰å…¨çš„"],["protect","ä¿æŠ¤"],
    ["heal","æ„ˆåˆ"]
  ]
};

const DISEASES = ["headache","toothache","stomach-ache","backache","cold","hurt"];

const DISEASE_NAMES = {
  headache: "å¤´ç—›",
  toothache: "ç‰™ç—›",
  "stomach-ache": "èƒƒç—›",
  backache: "èƒŒç—›",
  cold: "æ„Ÿå†’",
  hurt: "å¤–ä¼¤"
};

/* ===== çŠ¶æ€ ===== */
let state = JSON.parse(localStorage.getItem("DOG_APP")) || {
  score: 0,
  mood: "healthy",
  disease: null,
  color: "#ffffff",
  earL: 0,
  earR: 0,
  eyeL: 0,
  eyeR: 0,
  designs: []
};

let mode = "study";
let checkupCount = 0;
let currentWords = [];

function save() {
  localStorage.setItem("DOG_APP", JSON.stringify(state));
}

/* ===== é¡µé¢åˆ‡æ¢ ===== */
function enterStudy() {
  mode = "study";
  currentWords = getAllWords();
  quizTitle.innerText = "ğŸ“˜ å­¦ä¹ æ¨¡å¼";
  home.classList.add("hidden");
  quiz.classList.remove("hidden");
  next();
}

function enterCheckup() {
  if (state.mood !== "sick") {
    alert("å°ç‹—å¾ˆå¥åº·ï¼Œä¸éœ€è¦ä½“æ£€ï¼");
    return;
  }
  mode = "checkup";
  checkupCount = 0;
  currentWords = WORD_GROUPS[state.disease].map(w => ({en: w[0], cn: w[1]}));
  quizTitle.innerText = `ğŸ¥ ä½“æ£€ä¸­ï¼ˆ${DISEASE_NAMES[state.disease]}ï¼‰- å®Œæˆ 10 é¢˜`;
  home.classList.add("hidden");
  quiz.classList.remove("hidden");
  next();
}

function backHome() {
  quiz.classList.add("hidden");
  shop.classList.add("hidden");
  designPanel.classList.add("hidden");
  gallery.classList.add("hidden");
  home.classList.remove("hidden");
}

function openShop() {
  home.classList.add("hidden");
  shop.classList.remove("hidden");
}

function closeShop() {
  shop.classList.add("hidden");
  home.classList.remove("hidden");
}

function openDesign() {
  home.classList.add("hidden");
  designPanel.classList.remove("hidden");
  loadCurrentDesign();
}

function closeDesign() {
  designPanel.classList.add("hidden");
  home.classList.remove("hidden");
}

function viewGallery() {
  designPanel.classList.add("hidden");
  gallery.classList.remove("hidden");
  renderGallery();
}

function closeGallery() {
  gallery.classList.add("hidden");
  designPanel.classList.remove("hidden");
}

/* ===== å·¥å…·å‡½æ•° ===== */
function getAllWords() {
  let all = [];
  for (let disease in WORD_GROUPS) {
    all = all.concat(WORD_GROUPS[disease].map(w => ({en: w[0], cn: w[1]})));
  }
  return all;
}

/* ===== å‡ºé¢˜ ===== */
let current, modeQ, opts = [], blankIdx;

function next() {
  spellInput.value = "";
  choices.classList.remove("hidden");
  spell.classList.add("hidden");
  blank.classList.add("hidden");

  if (currentWords.length === 0) currentWords = getAllWords();
  
  current = currentWords[Math.floor(Math.random() * currentWords.length)];
  const r = Math.random();
  if (r < 0.33) modeQ = "choice";
  else if (r < 0.66) modeQ = "spell";
  else modeQ = "blank";

  if (modeQ === "choice") {
    const wrong = currentWords[Math.floor(Math.random() * currentWords.length)];
    const en2cn = Math.random() < 0.5;
    question.innerText = en2cn
      ? `"${current.en}" æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ`
      : `"${current.cn}" ç”¨è‹±æ–‡æ€ä¹ˆè¯´ï¼Ÿ`;
    const correct = en2cn ? current.cn : current.en;
    opts = [correct, en2cn ? wrong.cn : wrong.en].sort(() => Math.random() - 0.5);
    c0.innerText = opts[0];
    c1.innerText = opts[1];
  }
  else if (modeQ === "spell") {
    choices.classList.add("hidden");
    spell.classList.remove("hidden");
    question.innerText = "æ‹¼å†™å•è¯";
    spellHint.innerText = "ä¸­æ–‡æç¤ºï¼š" + current.cn;
  }
  else {
    choices.classList.add("hidden");
    blank.classList.remove("hidden");
    question.innerText = "è¡¥å…¨å•è¯";
    const w = current.en;
    blankIdx = Math.floor(w.length / 2);
    blankWord.innerHTML = w.split("").map((c, i) => 
      i === blankIdx ? '<span class="blank"></span>' : c
    ).join("");
    letters.innerHTML = "";
    const correct = w[blankIdx];
    const wrong = String.fromCharCode(97 + Math.floor(Math.random() * 26));
    [correct, wrong].sort(() => Math.random() - 0.5).forEach(l => {
      const b = document.createElement("button");
      b.className = "letter-btn";
      b.innerText = l;
      b.onclick = () => checkBlank(l);
      letters.appendChild(b);
    });
  }
}

/* ===== ç­”é¢˜å¤„ç† ===== */
function afterAnswer(correct) {
  if (correct) {
    state.score += 1;
    showFeedback("âœ… ç­”å¯¹äº†ï¼+" + 1 + " åˆ†", true);
  } else {
    showFeedback("âŒ ç­”é”™äº†\næ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š" + current.en + " / " + current.cn, false);
  }

  if (mode === "checkup") {
    checkupCount++;
    quizTitle.innerText = `ğŸ¥ ä½“æ£€ä¸­ï¼ˆ${DISEASE_NAMES[state.disease]}ï¼‰- ${checkupCount}/10 é¢˜`;
    
    if (checkupCount >= 10) {
      setTimeout(() => {
        alert("âœ… ä½“æ£€å®Œæˆï¼å°ç‹—å·²åº·å¤ï¼");
        state.mood = "healthy";
        state.disease = null;
        mode = "study";
        checkupCount = 0;
        save();
        render();
        backHome();
      }, 1000);
      return;
    }
  }

  setTimeout(() => {
    checkDisease();
    save();
    render();
    next();
  }, 1500);
}

function showFeedback(msg, isCorrect) {
  const pet = document.getElementById("dog");
  if (isCorrect) {
    pet.classList.add("happy");
    setTimeout(() => pet.classList.remove("happy"), 500);
  }
  alert(msg);
}

function choose(i) {
  const correct = opts[i] === current.en || opts[i] === current.cn;
  afterAnswer(correct);
}

function spellCheck() {
  afterAnswer(spellInput.value.trim().toLowerCase() === current.en);
}

function checkBlank(l) {
  afterAnswer(l === current.en[blankIdx]);
}

/* ===== ç”Ÿç—…ç³»ç»Ÿ ===== */
function checkDisease() {
  if (state.mood === "sick") return;
  
  if (state.score >= 30 && Math.random() < 0.3) {
    state.mood = "sick";
    state.disease = randomDisease();
    alert(`âš ï¸ å°ç‹—ç”Ÿç—…äº†ï¼\nç—‡çŠ¶ï¼š${DISEASE_NAMES[state.disease]}\nè¯·å»ä½“æ£€æˆ–è´­ä¹°å¯¹åº”è¯å“ï¼`);
  } else if (state.score >= 15 && Math.random() < 0.15) {
    state.mood = "sick";
    state.disease = randomDisease();
    alert(`âš ï¸ å°ç‹—ç”Ÿç—…äº†ï¼\nç—‡çŠ¶ï¼š${DISEASE_NAMES[state.disease]}\nè¯·å»ä½“æ£€æˆ–è´­ä¹°å¯¹åº”è¯å“ï¼`);
  }
}

function randomDisease() {
  return DISEASES[Math.floor(Math.random() * DISEASES.length)];
}

/* ===== å•†åº— ===== */
function buyMedicine(type) {
  if (state.mood !== "sick") {
    alert("âŒ å°ç‹—ç°åœ¨å¾ˆå¥åº·ï¼Œä¸éœ€è¦åƒè¯ï¼");
    return;
  }
  if (state.score < 5) {
    alert("âŒ ç§¯åˆ†ä¸å¤Ÿï¼éœ€è¦ 5 ç§¯åˆ†");
    return;
  }
  if (type !== state.disease) {
    alert(`âŒ ç”¨é”™è¯äº†ï¼\nå½“å‰ç—‡çŠ¶ï¼š${DISEASE_NAMES[state.disease]}\nè¯·è´­ä¹°å¯¹åº”çš„è¯å“`);
    return;
  }
  
  state.score -= 5;
  state.mood = "healthy";
  state.disease = null;
  alert("âœ… åƒè¯æˆåŠŸï¼å°ç‹—å·²åº·å¤ï¼");
  save();
  render();
  closeShop();
}

/* ===== è®¾è®¡ç³»ç»Ÿ ===== */
function loadCurrentDesign() {
  colorPicker.value = state.color;
  earLAngle.value = state.earL;
  earRAngle.value = state.earR;
  eyeLAngle.value = state.eyeL;
  eyeRAngle.value = state.eyeR;
  updateDesignPreview();
}

colorPicker.addEventListener("input", updateDesignPreview);
earLAngle.addEventListener("input", updateDesignPreview);
earRAngle.addEventListener("input", updateDesignPreview);
eyeLAngle.addEventListener("input", updateDesignPreview);
eyeRAngle.addEventListener("input", updateDesignPreview);

function updateDesignPreview() {
  const color = colorPicker.value;
  const earL = parseInt(earLAngle.value);
  const earR = parseInt(earRAngle.value);
  const eyeL = parseInt(eyeLAngle.value);
  const eyeR = parseInt(eyeRAngle.value);
  
  earLVal.innerText = earL + "Â°";
  earRVal.innerText = earR + "Â°";
  eyeLVal.innerText = eyeL + "Â°";
  eyeRVal.innerText = eyeR + "Â°";
  
  applyDesign(color, earL, earR, eyeL, eyeR);
}

function applyDesign(color, earL, earR, eyeL, eyeR) {
  dog.style.setProperty("--dogColor", color);
  document.getElementById("earL").setAttribute("transform", `rotate(${earL})`);
  document.getElementById("earR").setAttribute("transform", `rotate(${earR})`);
  document.getElementById("eyeL").setAttribute("transform", `rotate(${eyeL})`);
  document.getElementById("eyeR").setAttribute("transform", `rotate(${eyeR})`);
}

function saveDesign() {
  if (state.score < 2) {
    alert("âŒ ç§¯åˆ†ä¸å¤Ÿï¼éœ€è¦ 2 ç§¯åˆ†");
    return;
  }
  
  const name = designName.value.trim() || "è®¾è®¡-" + (state.designs.length + 1);
  
  const design = {
    name: name,
    color: colorPicker.value,
    earL: parseInt(earLAngle.value),
    earR: parseInt(earRAngle.value),
    eyeL: parseInt(eyeLAngle.value),
    eyeR: parseInt(eyeRAngle.value)
  };
  
  state.designs.push(design);
  state.score -= 2;
  state.color = design.color;
  state.earL = design.earL;
  state.earR = design.earR;
  state.eyeL = design.eyeL;
  state.eyeR = design.eyeR;
  
  designName.value = "";
  alert("âœ… è®¾è®¡å·²ä¿å­˜ï¼-2 ç§¯åˆ†");
  save();
  render();
}

function renderGallery() {
  galleryGrid.innerHTML = "";
  
  if (state.designs.length === 0) {
    galleryGrid.innerHTML = "<p style='grid-column:1/-1;color:#999'>è¿˜æ²¡æœ‰ä¿å­˜çš„è®¾è®¡</p>";
    return;
  }
  
  state.designs.forEach((design, index) => {
    const item = document.createElement("div");
    item.className = "design-item";
    item.innerHTML = `
      <svg viewBox="0 0 200 360">
        <ellipse cx="100" cy="200" rx="65" ry="90" fill="${design.color}" stroke="#888" stroke-width="3"/>
        <circle cx="100" cy="100" r="55" fill="${design.color}" stroke="#888" stroke-width="3"/>
        <g transform="rotate(${design.earL} 55 65)">
          <ellipse cx="55" cy="65" rx="18" ry="38" fill="${design.color}" stroke="#888" stroke-width="2"/>
        </g>
        <g transform="rotate(${design.earR} 145 65)">
          <ellipse cx="145" cy="65" rx="18" ry="38" fill="${design.color}" stroke="#888" stroke-width="2"/>
