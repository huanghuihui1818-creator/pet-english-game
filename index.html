<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è‹±è¯­å°ç‹— Â· å®¶åº­ç»ˆæç‰ˆ</title>

<style>
body{
  margin:0;
  font-family:"Comic Sans MS","PingFang SC",sans-serif;
  background:linear-gradient(#eef7ff,#ffffff);
  text-align:center;
}
h1{margin:8px}
.hidden{display:none}

/* ===== å¡ç‰‡ ===== */
.card{
  background:#fff;border-radius:18px;
  padding:14px;width:420px;
  margin:10px auto;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
}
button{
  width:100%;padding:12px;
  margin:6px 0;font-size:16px;
  border:none;border-radius:12px;
  background:#4caf50;color:#fff;
}
.secondary{background:#2196f3}
.shop{background:#ff9800}
.back{background:#9e9e9e}
input[type=range]{width:90%}
input[type=color]{margin-top:6px}

/* ===== å°ç‹— ===== */
.pet-wrap{position:relative;margin:10px auto;width:300px}
.pet{
  width:280px;height:280px;
  transition:transform .3s;
}
.pet.happy{transform:translateY(-8px)}
.ear{transform-origin:center bottom}
.eye{transform-origin:center center}

/* ===== æŒ–ç©ºåŠ¨ç”» ===== */
.blank{
  display:inline-block;
  width:24px;
  border-bottom:3px solid #333;
  margin:0 2px;
  animation:pulse .8s infinite alternate;
}
@keyframes pulse{
  from{opacity:.4}
  to{opacity:1}
}
.letter-btn{
  width:auto;
  display:inline-block;
  margin:4px;
  padding:10px 14px;
}
</style>
</head>

<body>

<h1>ğŸ¶ æˆ‘çš„è‹±è¯­å°ç‹—</h1>

<!-- ===== å°ç‹— ===== -->
<div class="pet-wrap">
<svg id="dog" class="pet" viewBox="0 0 200 300">
  <ellipse cx="100" cy="180" rx="65" ry="85"
    fill="var(--dogColor,#fff)" stroke="#ccc" stroke-width="4"/>
  <circle cx="100" cy="90" r="55"
    fill="var(--dogColor,#fff)" stroke="#ccc" stroke-width="4"/>
  <ellipse id="earL" class="ear" cx="55" cy="60" rx="18" ry="35"
    fill="var(--dogColor,#fff)" stroke="#ccc"/>
  <ellipse id="earR" class="ear" cx="145" cy="60" rx="18" ry="35"
    fill="var(--dogColor,#fff)" stroke="#ccc"/>
  <circle id="eyeL" class="eye" cx="85" cy="90" r="6"/>
  <circle id="eyeR" class="eye" cx="115" cy="90" r="6"/>
  <circle cx="100" cy="105" r="5"/>
  <path d="M88 118 Q100 128 112 118"
    stroke="#000" stroke-width="3" fill="none"/>
  <line x1="80" y1="240" x2="80" y2="280" stroke="#ccc" stroke-width="6"/>
  <line x1="120" y1="240" x2="120" y2="280" stroke="#ccc" stroke-width="6"/>
</svg>
</div>

<div id="status"></div>
<div id="score"></div>

<!-- ===== ä¸»é¡µ ===== -->
<div class="card" id="home">
  <button onclick="enterStudy()">ğŸ“˜ å­¦ä¹ </button>
  <button class="secondary" onclick="enterCheckup()">ğŸ¥ ä½“æ£€</button>
  <button class="shop" onclick="openShop()">ğŸª å•†åº— / è®¾è®¡</button>
</div>

<!-- ===== å­¦ä¹  / ä½“æ£€å…±ç”¨ç­”é¢˜åŒº ===== -->
<div class="card hidden" id="quiz">
  <div id="quizTitle"></div>
  <div id="question"></div>

  <div id="choices">
    <button onclick="choose(0)" id="c0"></button>
    <button onclick="choose(1)" id="c1"></button>
  </div>

  <div id="spell" class="hidden">
    <div id="spellHint"></div>
    <input id="spellInput" placeholder="æ‹¼å†™è‹±æ–‡">
    <button onclick="spellCheck()">æäº¤</button>
  </div>

  <div id="blank" class="hidden">
    <div id="blankWord"></div>
    <div id="letters"></div>
  </div>

  <button class="back" onclick="backHome()">â¬… è¿”å›ä¸»é¡µ</button>
</div>

<!-- ===== å•†åº— ===== -->
<div class="card hidden" id="shop">
  <h3>ğŸ’Š è¯å“å•†åº—ï¼ˆ5 åˆ† / ä¸ªï¼‰</h3>
  <button onclick="buyMedicine('headache')">ğŸ’Š å¤´ç—›è¯</button>
  <button onclick="buyMedicine('toothache')">ğŸ’Š ç‰™ç—›è¯</button>
  <button onclick="buyMedicine('stomach-ache')">ğŸ’Š èƒƒç—›è¯</button>
  <button onclick="buyMedicine('backache')">ğŸ’Š èƒŒç—›è¯</button>
  <button onclick="buyMedicine('cold')">ğŸ’Š æ„Ÿå†’è¯</button>
  <button onclick="buyMedicine('hurt')">ğŸ’Š å¤–ä¼¤è¯</button>
  <button class="back" onclick="closeShop()">â¬… è¿”å›</button>
</div>

<script>
/* ===== è¯åº“ï¼ˆç™½æ¿æ•´ç†ï¼Œç¤ºä¾‹ï¼‰ ===== */
const WORDS=[
["practice","ç»ƒä¹ "],["prepare","å‡†å¤‡"],["balance","å¹³è¡¡"],["control","æ§åˆ¶"],
["brain","å¤§è„‘"],["stomach","èƒƒ"],["headache","å¤´ç—›"],["toothache","ç‰™ç—›"],
["healthy","å¥åº·çš„"],["breathe","å‘¼å¸"],["dangerous","å±é™©çš„"],
["hurt","å—ä¼¤"],["temperature","ä½“æ¸©"],["nature","è‡ªç„¶"],
["design","è®¾è®¡"],["create","åˆ›é€ "],["travel","æ—…è¡Œ"],
["plan","è®¡åˆ’"],["find","æ‰¾åˆ°"],["think","æ€è€ƒ"]
].map(w=>({en:w[0],cn:w[1]}));

const DISEASES=["headache","toothache","stomach-ache","backache","cold","hurt"];

/* ===== çŠ¶æ€ ===== */
let state=JSON.parse(localStorage.getItem("DOG_APP"))||{
  score:0,
  mood:"healthy",
  disease:null,
  color:"#ffffff"
};

let mode="study"; // study | checkup
let checkupCount=0;

function save(){localStorage.setItem("DOG_APP",JSON.stringify(state))}

/* ===== é¡µé¢åˆ‡æ¢ ===== */
function enterStudy(){
  mode="study";
  quizTitle.innerText="ğŸ“˜ å­¦ä¹ ";
  home.classList.add("hidden");
  quiz.classList.remove("hidden");
  next();
}
function enterCheckup(){
  mode="checkup";
  checkupCount=0;
  quizTitle.innerText="ğŸ¥ ä½“æ£€ï¼ˆå®Œæˆ 10 é¢˜ï¼‰";
  home.classList.add("hidden");
  quiz.classList.remove("hidden");
  next();
}
function backHome(){
  quiz.classList.add("hidden");
  shop.classList.add("hidden");
  home.classList.remove("hidden");
}
function openShop(){
  home.classList.add("hidden");
  shop.classList.remove("hidden");
}
function closeShop(){
  shop.classList.add("hidden");
  home.classList.remove("hidden");
}

/* ===== å‡ºé¢˜ ===== */
let current,modeQ,opts=[],blankIdx;

function next(){
  spellInput.value="";
  choices.classList.remove("hidden");
  spell.classList.add("hidden");
  blank.classList.add("hidden");

  current=WORDS[Math.floor(Math.random()*WORDS.length)];
  const r=Math.random();
  if(r<0.33) modeQ="choice";
  else if(r<0.66) modeQ="spell";
  else modeQ="blank";

  if(modeQ==="choice"){
    const wrong=WORDS[Math.floor(Math.random()*WORDS.length)];
    const en2cn=Math.random()<0.5;
    question.innerText=en2cn
      ? current.en+" æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"
      : current.cn+" ç”¨è‹±æ–‡æ€ä¹ˆè¯´ï¼Ÿ";
    const correct=en2cn?current.cn:current.en;
    opts=[correct,en2cn?wrong.cn:wrong.en].sort(()=>Math.random()-0.5);
    c0.innerText=opts[0]; c1.innerText=opts[1];
  }
  else if(modeQ==="spell"){
    choices.classList.add("hidden");
    spell.classList.remove("hidden");
    question.innerText="æ‹¼å†™å•è¯";
    spellHint.innerText="ä¸­æ–‡ï¼š"+current.cn;
  }
  else{
    choices.classList.add("hidden");
    blank.classList.remove("hidden");
    question.innerText="è¡¥å…¨å•è¯";
    const w=current.en;
    blankIdx=Math.floor(w.length/2);
    blankWord.innerHTML=w.split("").map((c,i)=>i===blankIdx?'<span class="blank"></span>':c).join("");
    letters.innerHTML="";
    const correct=w[blankIdx];
    const wrong=String.fromCharCode(97+Math.floor(Math.random()*26));
    [correct,wrong].sort(()=>Math.random()-0.5).forEach(l=>{
      const b=document.createElement("button");
      b.className="letter-btn"; b.innerText=l;
      b.onclick=()=>checkBlank(l);
      letters.appendChild(b);
    });
  }
}

/* ===== ç­”é¢˜å¤„ç† ===== */
function afterAnswer(correct){
  if(correct) state.score+=1;
  else alert("æç¤ºï¼šæ­£ç¡®ç­”æ¡ˆæ˜¯ "+current.en+" / "+current.cn);

  if(mode==="checkup"){
    checkupCount++;
    if(checkupCount>=10){
      alert("ä½“æ£€å®Œæˆ âœ…");
      mode="study";
      checkupCount=0;
      checkDisease();
      save();render();
      backHome();
      return;
    }
  }
  checkDisease();
  save();render();
  next();
}

function choose(i){
  const correct = opts[i]===current.en || opts[i]===current.cn;
  afterAnswer(correct);
}
function spellCheck(){
  afterAnswer(spellInput.value.trim().toLowerCase()===current.en);
}
function checkBlank(l){
  afterAnswer(l===current.en[blankIdx]);
}

/* ===== ç”Ÿç—… ===== */
function checkDisease(){
  if(state.score>30){
    state.mood="sick";
    state.disease=randomDisease();
  }else if(state.score>15){
    state.mood="sick";
    state.disease=randomDisease();
  }
}
function randomDisease(){
  return DISEASES[Math.floor(Math.random()*DISEASES.length)];
}

/* ===== å•†åº— ===== */
function buyMedicine(type){
  if(state.mood!=="sick"){alert("ç°åœ¨ä¸éœ€è¦åƒè¯");return;}
  if(state.score<5){alert("ç§¯åˆ†ä¸å¤Ÿ");return;}
  if(type!==state.disease){alert("ç”¨é”™è¯äº†");return;}
  state.score-=5;
  state.mood="healthy";
  state.disease=null;
  save();render();
}

/* ===== æ¸²æŸ“ ===== */
function render(){
  score.innerText="ç§¯åˆ†ï¼š"+state.score;
  status.innerText=
    state.mood==="healthy"
    ? "çŠ¶æ€ï¼šå¥åº· ğŸ˜Š"
    : "çŠ¶æ€ï¼šç”Ÿç—…äº† ğŸ¤’ï¼ˆ"+state.disease+"ï¼‰";
  dog.style.setProperty("--dogColor",state.color);
}
render();save();
</script>

</body>
</html>
